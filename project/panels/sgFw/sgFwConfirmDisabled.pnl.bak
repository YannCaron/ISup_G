V 11
1
LANG:5 20 Disable confirmation
PANEL,-1 -1 442 154 N "_3DFace" 2
"$systemName"
"$systemStatus"
"main()
{
  panel_onLoad();
}" 0
 E E E E 1 -1 -1 0  0 0
""0  1
E "const int INFINIT_PERIOD = 0;
const int HOUR_PERIOD = 3600;
const int DAY_PERIOD = 86400;
const int WEEK_PERIOD = 604800;
const int MONTH_PERDIOD = 2592000;

const string systemName = $systemName;
const string systemStatus = $systemStatus;

bool disabled;
string eventText;
dyn_string histories;
string params;
  
void panel_onLoad() {
  
  DebugTN(systemName);
  DebugTN(systemStatus);
  
	dpGet(systemName + systemStatus + DISABLED_POSTFIX, disabled,
	      systemName + systemStatus + EVENT_TEXT_POSTFIX, eventText,
	      systemName + systemStatus + EVENT_HISTORIES_POSTFIX, histories,
				systemName + systemStatus + PARAMS_POSTFIX, params);

  // 2006.09.29 aj as soon as params are configured, histories are not considered at al
 	if(params != \"\") dpGet(systemName + params + \".Histories\", histories);
 	for(int i = 1; i <= dynlen(histories); i++) {
		histories[i] = systemName + histories[i];
	}

  if(eventText == \"\") eventText = dpGetDescription(systemName + systemStatus);

  lbConfirm.text = \"Do you really want to \" + (disabled ? \"enable\" : \"disable\") + \" the point: \"+ \"\\n\" + \"<<\" + eventText + \">> ?\";
  cbTime.visible = !disabled;
    
}

int getDurationSeconds() {
  switch (cbTime.selectedPos) {
    case 1 : return HOUR_PERIOD;
    case 2 : return HOUR_PERIOD * 4;
    case 3 : return DAY_PERIOD;
    case 4 : return DAY_PERIOD * 2;
    case 5 : return WEEK_PERIOD;
    case 6 : return WEEK_PERIOD * 2;
    case 7 : return MONTH_PERIOD;
    case 8 : return MONTH_PERIOD * 2;
    default : return INFINIT_PERIOD;
  }
}

void logToHistory() {
  string clientName = getHostname();
  string verb = disabled ? \"enabled\" : \"disabled\";
  
 	if(dynlen(histories) >= 1) {
    // local history
		sgHistoryAddEvent(histories, disabled ? SEVERITY_ENABLE : SEVERITY_DISABLE, eventText + \" \" + verb + \" by Client: \" + clientName);			
  }	else {
    // system history
		sgHistoryAddEvent(systemName + SYSTEM_HISTORY, SEVERITY_SYSTEM, \"Client: \" + clientName + \" \" + verb + \" \" + eventText + \" (\" + systemName + systemStatus + \")\");			
	}
}

void btOk_onClick() {
  int disabledTime = period(getCurrentTime()) + getDurationSeconds();

	dpSet(systemName + systemStatus + DISABLED_POSTFIX, !disabled,
        systemName + systemStatus + DISABLED_TIME_POSTFIX, disabledTime,
        systemName + systemStatus + DISABLED_TIME_POSTFIX + ORIGINAL_USERBIT_1, false,
        systemName + systemStatus + ALARM_ACTIVE_POSTFIX, false);
  
  logToHistory();
  
  PanelOffReturn(makeDynFloat(0), makeDynBool(TRUE));

}

void btNok_onClick() {

  PanelOffReturn(makeDynFloat(0), makeDynBool(FALSE));

}" 0
 2
"CBRef" "1"
"EClose" E
""
DISPLAY_LAYER, 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
LAYER, 0 
1
LANG:5 0 
2 0
"Text1"
""
1 10 10 E E E 1 E 1 E N {0,0,0} E N {255,255,255} E E
 E E
0 0 0 0 0 0
E E E
0
2
LANG:5 0 
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  2  0 3  "0.bmp" 13434828 E 12 12 48 48
0 2 0 "0s" 0 0 0 64 0 0  12 12 1
2
LANG:5 27 Tahoma,-1,19,5,40,0,0,0,0,0
LANG:1 109 -microsoft windows-Tahoma-normal-r-normal-*-*-170-100-100-*-*-iso8859-1|-19,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
0 2
LANG:5 0 
LANG:1 0 
2 1
"lbConfirm"
""
1 73 20 E E E 1 E 1 E N "_3DText" E N "_Transparent" E E
 E E
1 0 0 0 0 0
E E E
0
3
LANG:5 0 
LANG:1 0 
LANG:0 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 0 1 E U  0 E 90 20 400 36
0 0 0 "0s" 0 0 0 193 0 0  245 20 1
3
LANG:5 27 Tahoma,-1,13,5,69,0,0,0,0,0
LANG:1 107 -microsoft windows-Tahoma-bold-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,700,0,0,0,0,3,2,1,34,Tahoma
LANG:0 109 -microsoft windows-Tahoma-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
0 3
LANG:5 44 Questionxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LANG:1 44 Questionxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
LANG:0 45 Fragexxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
13 4
"btNok"
""
1 279 108 E E E 1 E 1 E N "_ButtonText" E N "_Button" E E
 E E
4 0 0 0 39 0
E E E
0
3
LANG:5 0 
LANG:1 0 
LANG:0 0 

0
3
LANG:5 27 Tahoma,-1,13,5,40,0,0,0,0,0
LANG:1 109 -microsoft windows-Tahoma-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
LANG:0 109 -microsoft windows-Tahoma-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
0  278 108 382 136

T 
3
LANG:5 2 No
LANG:1 6 Cancel
LANG:0 9 Abbrechen
"main()
{
  btNok_onClick();
}
" 0
 E E E
13 5
"btOk"
""
1 88 108 E E E 1 E 1 E N "_ButtonText" E N "_Button" E E
 E E
5 0 0 0 0 0
E E E
0
3
LANG:5 0 
LANG:1 0 
LANG:0 0 

0
3
LANG:5 27 Tahoma,-1,13,5,40,0,0,0,0,0
LANG:1 109 -microsoft windows-Tahoma-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
LANG:0 109 -microsoft windows-Tahoma-normal-r-normal-*-*-120-100-100-*-*-iso8859-1|-13,0,0,0,400,0,0,0,0,3,2,1,34,Tahoma
0  88 108 192 136

T 
3
LANG:5 3 Yes
LANG:1 2 OK
LANG:0 2 OK
"main()
{
  btOk_onClick	();
}
" 0
 E E E
22 6
"cbTime"
""
1 90 70 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
6 0 0 0 0 0
E E E
0
1
LANG:5 0 

0
1
LANG:5 37 MS Shell Dlg 2,8.25,-1,5,50,0,0,0,0,0
0  88 68 242 92
9
1
LANG:5 6 1 hour

0
1
LANG:5 7 4 hours

0
1
LANG:5 5 1 day

0
1
LANG:5 6 2 days

0
1
LANG:5 6 1 week

0
1
LANG:5 7 2 weeks

0
1
LANG:5 7 1 month

0
1
LANG:5 8 2 months

0
1
LANG:5 12 Indefinitely

0

E
E
E
 1 0
0
LAYER, 1 
1
LANG:5 0 
0
LAYER, 2 
1
LANG:5 0 
0
LAYER, 3 
1
LANG:5 0 
0
LAYER, 4 
1
LANG:5 0 
0
LAYER, 5 
1
LANG:5 0 
0
LAYER, 6 
1
LANG:5 0 
0
LAYER, 7 
1
LANG:5 0 
0
0
